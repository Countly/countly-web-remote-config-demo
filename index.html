<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countly Remote Config Demo</title>
    <link rel="stylesheet" href="output.css">
</head>

<body>
    <div class="w-full shadow p-5 mb-10 flex flex-col md:flex-row justify-between flex-wrap">
        <img src="countly-logo.svg" width="200" alt="countly">
        <div class="flex flex-col md:flex-row mt-5 md:mt-0">
            <div class="px-10">
                <strong>User Country</strong>
                <form onchange="userCountryChanged()">
                    <input type="radio" id="turkey" name="country" value="TR">
                    <label for="turkey">Turkey</label><br>
                    <input type="radio" id="other" name="country" value="US">
                    <label for="other">Other</label><br>
                </form> 
            </div>
            <div class="px-10">
            <strong>User Plan</strong>
                <form onchange="userPlanChanged()">
                    <input type="radio" id="regular" name="plan" value="regular">
                    <label for="regular">Regular</label><br>
                    <input type="radio" id="basic" name="plan" value="basic">
                    <label for="basic">Basic</label><br>
                    <input type="radio" id="pro" name="plan" value="pro">
                    <label for="pro">Pro</label>
                </form> 
            </div>

            <div class="px-10">
                <strong>User Type</strong>
                <form onchange="userTypeChanged()">
                    <input type="radio" id="beta" name="userType" value="true">
                    <label for="betaTestUser">Beta Test User</label><br>
                    <input type="radio" id="regularUser" name="userType" value="false">
                    <label for="regularUser">Regular User</label>
                </form> 
            </div>
            <div class="px-10 align-middle flex">
                <button onclick="location.reload()" class="m-3 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Save
                  </button>
            </div>
        </div>
    </div>
    <div class="mx-auto p-5">
        <div class="flex flex-row flex-wrap w-full">
            <div class="flex flex-col flex-wrap lg:w-5/12">
                <div class="flex flex-wrap flex-row">
                    <div class="md:w-1/3">
                        <label class="font-bold md:text-right mb-1 md:mb-0 pr-4" for="inline-full-name">
                            1 - Edit Main Title
                        </label>
                    </div>
                    <div>
                        <input class="appearance-none border-2 border-gray-700 rounded p-1" id="mainTitleInput"
                            type="text" value="">
                    </div>
                    <div>
                        <button class="ml-4 shadow font-bold py-2 px-4 rounded" onclick="saveMainTitle()" type="button">
                            Save
                        </button>
                    </div>
                </div>
                <div class="flex flex-row">
                    <div class="md:w-1/3">
                        <label class="font-bold md:text-right mb-1 md:mb-0 pr-4" for="inline-full-name">
                            2 - Edit CTA Heading
                        </label>
                    </div>
                    <div>
                        <input class="appearance-none border-2 border-gray-700 rounded p-1" id="CTAHeadingInput"
                            type="text" value="">
                    </div>
                    <div>
                        <button class="ml-4 shadow font-bold py-2 px-4 rounded" onclick="saveCTAHeading()" type="button">
                            Save
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex flex-row flex-wrap lg:w-4/12">
                <label class="font-bold md:text-right mb-1 md:mb-0 pr-4" for="inline-full-name">
                    3 - Change the color of CTA Button
                </label>
                <div class="flex flex-col">
                    <div>
                        <input type="radio" id="red" onchange="colorChanged(this)" name="gender" value="red">
                        <label for="red">Red</label>
                    </div>
                    <div>
                        <input type="radio" id="green" onchange="colorChanged(this)" name="gender" value="green">
                        <label for="green">Green</label>
                    </div>
                    <div>
                        <input type="radio" id="blue" onchange="colorChanged(this)" name="gender" value="blue">
                        <label for="blue">Blue</label>
                    </div>


                </div>
            </div>

            <div class="flex flex-row md:w-3/12">
                <label class="font-bold md:text-right mb-1 md:mb-0 pr-4" for="inline-full-name">
                    4 - Show / Hide Form
                </label>
                <div>

                    <input type="checkbox" id="Form" onchange="formStatus()" name="Form" checked>
                    <label for="vehicle3"> Show the form</label>
                </div>


            </div>

        </div>
        <hr class="my-4">
        <div class="flex flex-row flex-wrap w-full">
            <div class="md:w-1/2 p-4">
                <h1 class="text-3xl" id="MainTitle">Main Title</h1>
                <h3 class="text-xl">Countly</h3>
                <p>
                    Countly is the best analytics platform to understand and enhance customer journeys in web, desktop and mobile applications. We securely process billions of data points every day in the cloud and on-premises in order to help companies across the globe grow their business.

                </p>
            </div>
            <div class="md:w-1/2 p-4">
                <h1 class="text-3xl" id="CTAHeading">CTA Heading</h1>
                <span>Macoroni cheese slices squirty cheese edam</span>
                <form class="p-5" id="form">
                    <div class="mb-4">

                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="username" type="text" placeholder="name">
                    </div>
                    <div class="mb-6">

                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline"
                            id="password" type="text" placeholder="email">
                    </div>
                    <div class="flex items-center justify-between">
                        <button class="shadow font-bold py-2 px-4 rounded text-white" onclick="signUp()" type="button" id="CTAButton">
                            SignUp
                        </button>

                    </div>
                </form>
            </div>
        </div>
    </div>



    <script type='text/javascript'>

        //some default pre init
        var Countly = Countly || {};
        Countly.q = Countly.q || [];
        var appKey = "c2ae3fa480b274ad7b2a37587ed0639f1cd74e58";
        var apiKey = "fbade55547a5e56d70981dda8966afc5";
        var app_id = "5e58fe03b6e57432c373ad80";
        //provide countly initialization parameters
        Countly.app_key = appKey
        Countly.url = 'https://demo.count.ly/';
        Countly.app_version = "1.0.0";
        Countly.debug = true;
        Countly.remote_config = true;
        Countly.q.push(['track_sessions']);
        Countly.q.push(['track_pageview']);
        Countly.q.push(['track_clicks']);
        Countly.q.push(['track_errors']);
        Countly.q.push(['track_links']);
        Countly.q.push(['track_forms']);
        Countly.q.push(['collect_from_forms']);
        Countly.q.push(['track_scrolls']);
    
        Countly.remote_config = function(err, remoteConfigs){
        if (!err) {
            document.getElementById("MainTitle").innerText = remoteConfigs.MainTitle
            document.getElementById("mainTitleInput").value = remoteConfigs.MainTitle
            document.getElementById("CTAHeading").innerText = remoteConfigs.CTAHeading
            document.getElementById("CTAHeadingInput").value = remoteConfigs.CTAHeading
            document.getElementById("CTAButton").style.backgroundColor = remoteConfigs.CTAButtonColor
            document.getElementById(remoteConfigs.CTAButtonColor).checked = true
            document.getElementById("form").style.display = remoteConfigs.Form === "hide" ? "none" : "unset"
            document.getElementById("Form").checked = remoteConfigs.Form !== "hide"
        }
    };


    function getByKey(key,data) {
    var found = null;

    for (var i = 0; i < data.length; i++) {
        var element = data[i];

        if (element.parameter_key == key) {
           found = element;
       } 
    }

    return found;
}

        
 
        function userPlanChanged(){
            var selectedUserPlan = document.querySelector('input[name="plan"]:checked').value;
            Countly.q.push(['userData.set', "plan", selectedUserPlan]) //set custom property
            Countly.q.push(['userData.save']) //send userData to server
        }

        function userTypeChanged(){
            var selectedUserType = document.querySelector('input[name="userType"]:checked').value;
            Countly.q.push(['userData.set', "isTestUser", selectedUserType]) //set custom property
            Countly.q.push(['userData.save']) //send userData to server
        }

        function userCountryChanged(){
            var selectedCountry = document.querySelector('input[name="country"]:checked').value;
            Countly.country_code = selectedCountry;
        }

        function saveMainTitle(){
            var newValue = document.getElementById("mainTitleInput").value
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://demo.count.ly/o?app_id="+ app_id + "&api_key="+ apiKey  +"&method=remote-config");
            xhr.send();
            xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                var mainTitleObject=getByKey("MainTitle",JSON.parse(this.responseText).parameters)
                delete mainTitleObject['_id'];
                mainTitleObject.default_value = newValue
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "https://demo.count.ly/i/remote-config/update-parameter?parameter_id=5e609feeb6e57432c374042f&app_id=" + app_id + "&api_key="+ apiKey  +"&parameter="+ encodeURIComponent(JSON.stringify(mainTitleObject)));
                xhr.send();
                xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                    document.getElementById("MainTitle").innerText = newValue
                }
            }
            } 
                }
            }
            }    

            
        }


        function saveCTAHeading(){
            var newValue = document.getElementById("CTAHeadingInput").value


            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://demo.count.ly/o?app_id="+ app_id + "&api_key="+ apiKey  +"&method=remote-config");
            xhr.send();
            xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                var CTAHeadingObject=getByKey("CTAHeading",JSON.parse(this.responseText).parameters)
                delete CTAHeadingObject['_id'];
                CTAHeadingObject.default_value = newValue
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "https://demo.count.ly/i/remote-config/update-parameter?parameter_id=5e609fd5b6e57432c374042e&app_id=" + app_id + "&api_key="+ apiKey  +"&parameter="+ encodeURIComponent(JSON.stringify(CTAHeadingObject)));
                xhr.send();
                xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                    document.getElementById("CTAHeading").innerText = newValue
                }
            }
            } 
                }
            }
            }    
        }


        function colorChanged(e){
            var data = JSON.stringify(false);
            var newValue = e.value;
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://demo.count.ly/o?app_id="+ app_id + "&api_key="+ apiKey  +"&method=remote-config");
            xhr.send();
            xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                var CTAButtonObject=getByKey("CTAButtonColor",JSON.parse(this.responseText).parameters)
                delete CTAButtonObject['_id'];
                CTAButtonObject.default_value = newValue
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "https://demo.count.ly/i/remote-config/update-parameter?parameter_id=5e609fcab6e57432c374042d&app_id=" + app_id + "&api_key="+ apiKey  +"&parameter="+ encodeURIComponent(JSON.stringify(CTAButtonObject)));
                xhr.send();
                xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                    document.getElementById("CTAButton").style.backgroundColor = newValue
                }
            }
            } 
                }
            }
            }   
        }


        function formStatus(){
            var data = JSON.stringify(false);
            var newValue = document.getElementById("Form").checked ? "unset" : "hide";
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://demo.count.ly/o?app_id="+ app_id + "&api_key="+ apiKey  +"&method=remote-config");
            xhr.send();
            xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                var formObject=getByKey("Form",JSON.parse(this.responseText).parameters)
                delete formObject['_id'];
                formObject.default_value = newValue
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "https://demo.count.ly/i/remote-config/update-parameter?parameter_id=5e609fe06199db32c86ba6e7&app_id=" + app_id + "&api_key="+ apiKey  +"&parameter="+ encodeURIComponent(JSON.stringify(formObject)));
                xhr.send();
                xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if ((this.status == 200) && (this.status < 300)) {
                    document.getElementById("form").style.display = newValue === "hide" ? "none" : "unset"
                }
            }
            } 
                }
            }
            }  
          
   
        }


        function signUp(){
            Countly.q.push(['add_event',{
                "key": "signUp"
            }]);
        }


        //load countly script asynchronously
        (function() {
            var cly = document.createElement('script'); cly.type = 'text/javascript';
            cly.async = true;
            //enter url of script here
            cly.src = 'https://demo.count.ly/sdk/web/countly.min.js';
            cly.onload = function(){Countly.init()};
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(cly, s);
        })();

    </script>
</body>

</html>